From 1e3403567b882b4c655b74b21522d08c1183b48b Mon Sep 17 00:00:00 2001
From: Andy CrossGate Yan <GeForce8800Ultra@gmail.com>
Date: Thu, 29 Dec 2022 15:12:03 +0000
Subject: [PATCH 07/10] treble: Securize on-demand

Status is stored in /metadata and controlled by persist prop

Change-Id: I8069b6f471ad87ab34c18b743689ab3584cee35b
---
 phh-prop-handler.sh | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/phh-prop-handler.sh b/phh-prop-handler.sh
index 24056e4..8dd75be 100644
--- a/phh-prop-handler.sh
+++ b/phh-prop-handler.sh
@@ -228,3 +228,17 @@ if [ "$1" == "persist.bluetooth.system_audio_hal.enabled" ]; then
     restartAudio
     exit
 fi
+
+if [ "$1" == "persist.sys.phh.securize" ];then
+    if [[ "$prop_value" != "true" && "$prop_value" != "false" ]]; then
+        exit 1
+    fi
+
+    if [[ "$prop_value" == "true" ]]; then
+        mkdir /metadata/phh
+        touch /metadata/phh/secure
+    else
+        rm /metadata/phh/secure
+    fi
+    exit
+fi
-- 
2.34.1

